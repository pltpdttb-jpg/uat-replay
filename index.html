import React, { useState, useEffect, useRef } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously } from 'firebase/auth';
import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, limit, getDocs, where } from 'firebase/firestore';
import { 
  Mic, Square, Play, Award, ChevronLeft, User, Settings, CheckCircle, 
  BarChart, FileText, LogOut, AlertCircle, RefreshCw, 
  ArrowRight, Save, Volume2, Info, Headphones, X, Lock, Users, Trophy, Sliders, Calendar
} from 'lucide-react';

// --- Assets & Icons ---
const MamaLogo = ({ className = "w-10 h-10" }) => (
  <svg viewBox="0 0 100 100" className={className} fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect width="100" height="100" rx="24" fill="#1e3a8a"/>
    <path d="M20 70V30L35 60L50 30L65 60L80 30V70" stroke="white" strokeWidth="8" strokeLinecap="round" strokeLinejoin="round"/>
  </svg>
);

// --- Firebase Config (Global Context) ---
// Note: __firebase_config is initialized in main.jsx for deployment
const firebaseConfig = JSON.parse(window.__firebase_config);
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = typeof window.__app_id !== 'undefined' ? window.__app_id : 'default-app-id';

// --- Data Structures ---
const positionOptions = ["CFSA", "CISA", "BM", "WRM", "IS", "IA", "Other"];
const regionData = {
  "RH1": ["Zone จตุจักร", "Zone ธนบุรี", "Zone บางกะปิ", "Zone สาทร", "Zone สุขุมวิท"],
  "RH2": ["Zone ชลบุรี", "Zone บางนา", "Zone พัทยา", "Zone ระยอง"],
  "RH3": ["Zone เชียงใหม่", "Zone นครสวรรค์", "Zone นนทบุรี", "Zone พิษณุโลก", "Zone อยุธยา"],
  "RH4": ["Zone ดอนเมือง", "Zone นครราชสีมา", "Zone สระบุรี", "Zone อุดรธานี", "Zone อุบลราชธานี"],
  "RH5": ["Zone ภูเก็ต", "Zone ราชบุรี", "Zone สมุทรสาคร", "Zone สุราษฎร์ธานี", "Zone หาดใหญ่"]
};

const allScenarios = {
  mama1: [
    { 
      id: "M1-1", 
      title: "เจ้าของร้านอาหารต้องการขยายสาขา", 
      situation: "ลูกค้าเดินเข้ามาที่สาขาด้วยท่าทีเร่งรีบ แจ้งว่าต้องการโอนเงินไปต่างประเทศเพื่อสั่งซื้อวัตถุดิบ แต่มียอดเงินในบัญชีออมทรัพย์จำนวนมากที่ยังไม่ได้บริหารจัดการ",
      customerProfile: { 
        name: "คุณวิชัย", age: "38 ปี", occupation: "เจ้าของร้านอาหาร (SME)", income: "200,000+ บาท/เดือน", 
        status: "สมรส มีบุตร 1 คน", financial: "มีเงินฝากออมทรัพย์ 5 ล้านบาท, ไม่เคยลงทุน" 
      }, 
      objectives: ["เปิดใจลูกค้าเรื่องการบริหารเงินสด", "แนะนำบัญชีเงินฝากดอกเบี้ยสูงสำหรับธุรกิจ", "เสนอทางเลือกการโอนเงินที่คุ้มค่า"], 
      timeLimit: "3 นาที", objections: ["ผมรีบครับ เอาไว้ก่อนได้ไหม", "ดอกเบี้ยที่อื่นให้เยอะกว่านี้นะ", "ไม่อยากล็อคเงินเผื่อต้องใช้หมุนเวียน"] 
    },
    { 
      id: "M1-2", title: "พนักงานบริษัทเพิ่งได้รับโบนัสใหญ่", situation: "ลูกค้านัดพบที่ร้านกาแฟข้างตึกสำนักงาน แจ้งว่าเพิ่งได้รับโบนัสก้อนโตและอยากเริ่มต้นเก็บเงินจริงจัง แต่กังวลเรื่องความเสี่ยง",
      customerProfile: { name: "คุณก้อย", age: "32 ปี", occupation: "Marketing Manager", income: "80,000 บาท/เดือน", status: "โสด", financial: "มีหนี้บัตรเครดิตเล็กน้อย, รับความเสี่ยงได้ต่ำ" }, 
      objectives: ["สร้างความเข้าใจเรื่องความเสี่ยงและผลตอบแทน", "แนะนำกองทุนรวมตลาดเงินหรือตราสารหนี้", "วางแผนการออมระยะยาว (DCA)"], 
      timeLimit: "3 นาที", objections: ["เห็นข่าวหุ้นตกหนักมาก ไม่กล้าลงเลย", "ถ้าต้องใช้เงินด่วนจะถอนยากไหม", "ขอกลับไปปรึกษาที่บ้านก่อน"] 
    },
    { 
      id: "M1-3", title: "ฟรีแลนซ์รายได้สูงต้องการความมั่นคง", situation: "ลูกค้าเข้ามาที่สาขาเพื่อขอหนังสือรับรองบัญชีไปทำวีซ่า บ่นเรื่องภาระภาษีที่ต้องจ่ายเยอะมากในปีที่ผ่านมา",
      customerProfile: { name: "คุณเก่ง", age: "29 ปี", occupation: "Senior Software Engineer (Freelance)", income: "150,000 บาท/เดือน (ไม่แน่นอน)", status: "โสด", financial: "เงินเข้าออกบัญชีเยอะแต่ไม่มีการแยกบัญชีใช้จ่าย/เก็บออม" }, 
      objectives: ["ชี้ให้เห็นประโยชน์ของการวางแผนภาษี", "แนะนำประกันสะสมทรัพย์หรือกองทุนลดหย่อนภาษี", "เสนอโซลูชันการแยกบัญชีเพื่อวินัยทางการเงิน"], 
      timeLimit: "4 นาที", objections: ["รายได้ผมไม่แน่นอน กลัวจ่ายเบี้ยไม่ไหว", "อยากได้ตัวที่ลดหย่อนได้เยอะที่สุดแต่ล็อคสั้นๆ", "ประกันมันภาระผูกพันยาวเกินไป"] 
    }
  ],
  mama2: [
    { 
      id: "M2-1", title: "นักลงทุนมือใหม่กังวลตลาดผันผวน", situation: "ลูกค้านัดพบที่สาขา ถือเงินสด 1 ล้านบาทที่ครบกำหนดจากสลากออมสิน สนใจกองทุนรวมแต่เห็นข่าวเศรษฐกิจไม่ดีเลยลังเล", 
      customerProfile: { name: "คุณบอย", age: "40 ปี", occupation: "วิศวกรโยธา", income: "100,000 บาท/เดือน", status: "สมรส มีบุตร 2 คน", financial: "พอร์ตเดิมมีแต่เงินฝาก, รับความเสี่ยงได้ปานกลาง" }, 
      objectives: ["อธิบายสภาวะตลาดและโอกาสในวิกฤต", "แนะนำการจัดพอร์ตกระจายความเสี่ยง (Asset Allocation)", "สร้างความมั่นใจด้วยข้อมูลย้อนหลัง"], 
      timeLimit: "5 นาที", objections: ["กลัวเงินต้นหายเหมือนเพื่อน", "รอให้เศรษฐกิจดีกว่านี้ค่อยลงดีไหม", "ค่าธรรมเนียมกองทุนแพงไปหรือเปล่า"] 
    },
    { 
      id: "M2-2", title: "เศรษฐีที่ดินเพิ่งขายที่ได้", situation: "ลูกค้า VIP นัดไปพบที่บ้าน เพิ่งได้รับเช็คเงินสด 10 ล้านบาทจากการขายที่ดินมรดก ไม่มีความรู้เรื่องการเงินสมัยใหม่เลย", 
      customerProfile: { name: "คุณป้ามณี", age: "65 ปี", occupation: "แม่บ้าน / เกษียณ", income: "ไม่มีรายได้ประจำ", status: "ม่าย ลูกหลานโตหมดแล้ว", financial: "ต้องการรายได้สม่ำเสมอเหมือนเงินเดือนไว้ใช้จ่าย" }, 
      objectives: ["ออกแบบพอร์ตที่สร้างกระแสเงินสดรายเดือน (Passive Income)", "เน้นผลิตภัณฑ์คุ้มครองเงินต้นเป็นหลัก", "อธิบายด้วยภาษาที่เข้าใจง่าย ไม่ใช้ศัพท์เทคนิค"], 
      timeLimit: "5 นาที", objections: ["ป้าไม่เข้าใจเรื่องหุ้นเลย กลัวโดนหลอก", "ฝากประจำดอกเบี้ยน้อยแต่สบายใจกว่า", "ลูกบอกว่าอย่าเพิ่งทำอะไรกับเงินก้อนนี้"] 
    }
  ]
};

// --- Components ---

const Header = ({ title = "MAMA", user }) => (
  <div className="bg-white/90 backdrop-blur-md border-b sticky top-0 z-40 px-5 py-3 flex items-center justify-between shadow-sm">
    <div className="flex items-center space-x-3">
      <MamaLogo className="w-9 h-9 shadow-lg rounded-lg" />
      <span className="font-extrabold text-blue-900 tracking-tight text-lg">{title}</span>
    </div>
    {user && (
      <div className="flex flex-col items-end">
        <span className="text-xs font-bold text-gray-800">{user.firstName} {user.lastName}</span>
        <span className="text-[10px] text-gray-500 font-medium bg-gray-100 px-2 py-0.5 rounded-full mt-0.5">
          {user.position}
        </span>
      </div>
    )}
  </div>
);

const Footer = () => (
  <div className="py-4 text-center bg-gray-100 border-t mt-auto">
    <p className="text-[10px] text-gray-500 font-semibold tracking-wide">
      Powered by <span className="text-blue-900 font-bold">PRU Academy</span> [ttb training team]
    </p>
  </div>
);

const MiniGauge = ({ score, max, label, size = "normal" }) => {
  const percentage = (score / max) * 100;
  const radius = size === "small" ? 14 : 18;
  const stroke = size === "small" ? 3 : 4;
  const width = size === "small" ? 36 : 45;
  const circumference = 2 * Math.PI * radius;
  const offset = circumference - (percentage / 100) * circumference;
  const color = percentage >= 80 ? '#10b981' : percentage >= 60 ? '#f59e0b' : '#ef4444';

  return (
    <div className="bg-white p-2 rounded-xl border border-gray-100 flex flex-col items-center justify-center shadow-sm h-full">
      <div className="relative mb-1">
        <svg width={width} height={width} className="transform -rotate-90">
          <circle cx={width/2} cy={width/2} r={radius} stroke="#f1f5f9" strokeWidth={stroke} fill="none" />
          <circle cx={width/2} cy={width/2} r={radius} stroke={color} strokeWidth={stroke} fill="none" 
            strokeDasharray={circumference} strokeDashoffset={offset} strokeLinecap="round" className="transition-all duration-700" />
        </svg>
        <div className={`absolute inset-0 flex items-center justify-center font-bold text-gray-700 ${size==='small'?'text-[8px]':'text-[10px]'}`}>
          {Math.round(percentage)}
        </div>
      </div>
      <span className={`font-bold text-gray-400 text-center uppercase leading-tight line-clamp-2 ${size==='small'?'text-[7px]':'text-[8px]'}`}>{label}</span>
      <span className={`font-black text-blue-900 mt-0.5 ${size==='small'?'text-[9px]':'text-[10px]'}`}>{score}/{max}</span>
    </div>
  );
};

// --- Admin Components ---
const AdminLogin = ({ onLogin, onCancel }) => {
  const [passcode, setPasscode] = useState('');
  const [error, setError] = useState(false);

  const handleSubmit = (e) => {
    e.preventDefault();
    if(passcode === '2026') {
      onLogin();
    } else {
      setError(true);
    }
  };

  return (
    <div className="fixed inset-0 bg-blue-900/95 z-[60] flex items-center justify-center p-6 backdrop-blur-sm">
      <div className="bg-white rounded-[32px] p-8 w-full max-w-xs shadow-2xl relative overflow-hidden">
        <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-400 to-blue-600"></div>
        <div className="text-center mb-6">
          <div className="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4">
            <Lock className="text-blue-900" size={32} />
          </div>
          <h2 className="text-xl font-black text-gray-800">Admin Access</h2>
          <p className="text-xs text-gray-400 mt-1">Enter authorized passcode</p>
        </div>
        <form onSubmit={handleSubmit} className="space-y-4">
          <input 
            type="password" 
            autoFocus
            className={`w-full text-center text-2xl tracking-[0.5em] font-black border-b-2 py-3 outline-none transition-colors ${error ? 'border-red-500 text-red-500' : 'border-gray-200 text-gray-800 focus:border-blue-500'}`}
            value={passcode}
            onChange={(e) => {setPasscode(e.target.value); setError(false);}}
            maxLength={4}
          />
          {error && <p className="text-red-500 text-[10px] font-bold text-center">Incorrect Passcode</p>}
          <div className="grid grid-cols-2 gap-3 mt-6">
             <button type="button" onClick={onCancel} className="py-3 rounded-xl font-bold text-gray-400 text-xs hover:bg-gray-50">Cancel</button>
             <button type="submit" className="bg-blue-900 text-white py-3 rounded-xl font-bold text-xs shadow-lg">Access</button>
          </div>
        </form>
      </div>
    </div>
  );
};

const AdminDashboard = ({ onClose, currentPrompt, onSavePrompt }) => {
  const [activeTab, setActiveTab] = useState('prompt'); // prompt, ranking
  const [trainingTopic, setTrainingTopic] = useState("");
  const [rankFilter, setRankFilter] = useState('today'); // today, rh, course, champion
  const [leaderboardData, setLeaderboardData] = useState([]);
  const [loading, setLoading] = useState(false);

  // Fetch Data from Firebase on mount or filter change
  useEffect(() => {
    if (activeTab === 'ranking') {
      fetchLeaderboard();
    }
  }, [activeTab]);

  const fetchLeaderboard = async () => {
    setLoading(true);
    try {
      const q = query(
          collection(db, 'artifacts', appId, 'public', 'data', 'leaderboard'), 
          orderBy('score', 'desc'), 
          limit(200)
      );
      const snapshot = await getDocs(q);
      const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      setLeaderboardData(data);
    } catch (error) {
      console.error("Error fetching leaderboard:", error);
    }
    setLoading(false);
  };

  const getProcessedRanking = () => {
    if (loading) return [];
    const today = new Date().toISOString().split('T')[0];

    if (rankFilter === 'today') {
      const todaysData = leaderboardData.filter(d => d.dateStr === today);
      const mama1 = todaysData.filter(d => d.course === 'mama1').slice(0, 5);
      const mama2 = todaysData.filter(d => d.course === 'mama2').slice(0, 5);
      return [
        { title: "Today's Top 5: MAMA 1", data: mama1 },
        { title: "Today's Top 5: MAMA 2", data: mama2 }
      ];
    }

    if (rankFilter === 'rh') {
      const rhList = Object.keys(regionData);
      const courses = ['mama1', 'mama2'];
      let results = [];
      
      courses.forEach(c => {
        let courseData = [];
        rhList.forEach(rh => {
          const bestInRh = leaderboardData.find(d => d.course === c && d.user.region === rh);
          if (bestInRh) courseData.push(bestInRh);
        });
        results.push({ title: `Top by RH: ${c.toUpperCase()}`, data: courseData });
      });
      return results;
    }

    if (rankFilter === 'course') {
      const mama1 = leaderboardData.filter(d => d.course === 'mama1').slice(0, 3);
      const mama2 = leaderboardData.filter(d => d.course === 'mama2').slice(0, 3);
      return [
        { title: "All-Time Top 3: MAMA 1", data: mama1 },
        { title: "All-Time Top 3: MAMA 2", data: mama2 }
      ];
    }

    if (rankFilter === 'champion') {
      return [{ title: "Grand Champions (Top 10 All-Time)", data: leaderboardData.slice(0, 10) }];
    }

    return [];
  };

  const rankingDisplay = getProcessedRanking();

  const promptPreview = `
[SYSTEM ROLE]: คุณคือผู้เชี่ยวชาญด้านการฝึกอบรมการขายของธนาคาร (TTB Training Expert)
[CONTEXT]: ${trainingTopic || "(ระบุหัวข้อการสอน)"}
[EVALUATION CRITERIA]: วิเคราะห์ตามหลักการ 5 แกน (Voice, Structure, Info, Persuasion, Handling)
[INSTRUCTION]: ให้คะแนนและคำแนะนำที่สร้างสรรค์ เน้นการพัฒนาทักษะตามหัวข้อที่ระบุ
  `.trim();

  return (
    <div className="fixed inset-0 bg-gray-50 z-[50] flex flex-col font-sans animate-in slide-in-from-bottom duration-300">
      <div className="bg-blue-900 text-white p-6 pb-8 rounded-b-[40px] shadow-lg relative z-10">
        <div className="flex justify-between items-center mb-6">
          <h2 className="text-xl font-black flex items-center">
             <Settings className="mr-2 opacity-80" size={24} /> Admin Panel
          </h2>
          <button onClick={onClose} className="bg-white/10 hover:bg-white/20 p-2 rounded-full transition-colors">
            <X size={20} />
          </button>
        </div>
        
        <div className="flex bg-blue-800/50 p-1 rounded-2xl backdrop-blur-sm">
          <button 
            onClick={() => setActiveTab('prompt')}
            className={`flex-1 py-3 rounded-xl text-xs font-bold transition-all flex items-center justify-center ${activeTab === 'prompt' ? 'bg-white text-blue-900 shadow-md' : 'text-blue-200 hover:text-white'}`}
          >
            <Sliders size={14} className="mr-2" /> AI Configuration
          </button>
          <button 
             onClick={() => setActiveTab('ranking')}
             className={`flex-1 py-3 rounded-xl text-xs font-bold transition-all flex items-center justify-center ${activeTab === 'ranking' ? 'bg-white text-blue-900 shadow-md' : 'text-blue-200 hover:text-white'}`}
          >
            <Trophy size={14} className="mr-2" /> Leaderboard
          </button>
        </div>
      </div>

      <div className="flex-1 overflow-y-auto p-6 -mt-4 relative z-0 pt-8">
        {activeTab === 'prompt' ? (
          <div className="space-y-6">
            <div className="bg-white p-6 rounded-[32px] shadow-sm border border-gray-100">
               <h3 className="font-bold text-blue-900 mb-4 flex items-center text-sm uppercase tracking-wide">
                 <FileText size={16} className="mr-2" /> Training Focus
               </h3>
               <p className="text-xs text-gray-500 mb-4 leading-relaxed">
                 ระบุหัวข้อหรือเนื้อหาหลักที่คุณต้องการเน้นย้ำในการสอนครั้งนี้ AI จะใช้ข้อมูลนี้เป็นเกณฑ์หลักในการประเมินผู้เรียน
               </p>
               <textarea 
                 value={trainingTopic}
                 onChange={(e) => setTrainingTopic(e.target.value)}
                 placeholder="เช่น: เน้นการขายแบบ Consultative Selling, การใช้คำถามปลายเปิด, หรือการนำเสนอผลิตภัณฑ์กองทุนรวมลดหย่อนภาษี..."
                 className="w-full h-32 p-4 bg-gray-50 rounded-2xl text-sm border border-gray-200 focus:border-blue-500 focus:ring-2 ring-blue-100 outline-none transition-all placeholder:text-gray-300"
               />
            </div>

            <div className="bg-gray-100 p-6 rounded-[32px] border border-gray-200">
               <h3 className="font-bold text-gray-600 mb-2 text-xs uppercase tracking-wide">Generated System Prompt</h3>
               <div className="bg-white p-4 rounded-2xl text-[10px] font-mono text-gray-600 border border-gray-200 overflow-x-auto whitespace-pre-wrap leading-relaxed">
                 {promptPreview}
               </div>
            </div>

            <button 
              onClick={() => onSavePrompt(promptPreview)}
              className="w-full bg-blue-900 text-white py-4 rounded-2xl font-bold text-lg shadow-xl shadow-blue-200 active:scale-95 transition flex items-center justify-center"
            >
              <Save size={20} className="mr-2" /> Update AI Logic
            </button>
          </div>
        ) : (
          <div className="space-y-6">
             <div className="flex space-x-2 overflow-x-auto pb-2 no-scrollbar">
                {[
                  { id: 'today', label: 'Top by Today' },
                  { id: 'rh', label: 'Top by RH' },
                  { id: 'course', label: 'Top by Course' },
                  { id: 'champion', label: 'Champion' }
                ].map(f => (
                   <button 
                     key={f.id}
                     onClick={() => setRankFilter(f.id)}
                     className={`px-4 py-2 rounded-full text-[10px] font-bold uppercase whitespace-nowrap border ${rankFilter === f.id ? 'bg-blue-900 text-white border-blue-900' : 'bg-white text-gray-500 border-gray-200'}`}
                   >
                     {f.label}
                   </button>
                ))}
             </div>

             {loading ? (
                <div className="text-center py-10 text-gray-400 font-bold text-xs animate-pulse">Loading Leaderboard...</div>
             ) : rankingDisplay.length === 0 ? (
                <div className="text-center py-10 text-gray-400 font-bold text-xs">No data available for this filter.</div>
             ) : (
               <div className="space-y-6">
                 {rankingDisplay.map((group, gIdx) => (
                    <div key={gIdx}>
                      <h3 className="text-xs font-black text-blue-900 uppercase tracking-widest mb-3 pl-2 border-l-4 border-blue-500">{group.title}</h3>
                      <div className="space-y-3">
                        {group.data.length === 0 && <p className="text-[10px] text-gray-400 italic pl-4">No records found.</p>}
                        {group.data.map((item, idx) => (
                          <div key={idx} className="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm flex items-center">
                              <div className={`w-10 h-10 rounded-xl flex items-center justify-center font-black text-lg mr-4 ${idx === 0 ? 'bg-yellow-100 text-yellow-600' : idx === 1 ? 'bg-gray-100 text-gray-500' : idx === 2 ? 'bg-orange-100 text-orange-600' : 'bg-blue-50 text-blue-900'}`}>
                                {idx + 1}
                              </div>
                              <div className="flex-1">
                                <h4 className="font-bold text-gray-800 text-sm">{item.user.firstName} {item.user.lastName}</h4>
                                <div className="flex items-center text-[10px] text-gray-400 font-bold mt-0.5 space-x-2">
                                    <span className="bg-gray-100 px-1.5 py-0.5 rounded text-gray-500">{item.user.region}</span>
                                    <span className="text-blue-400">{item.course}</span>
                                    <span>{item.dateStr}</span>
                                </div>
                              </div>
                              <div className="text-right">
                                <span className="text-2xl font-black text-blue-900">{item.score}</span>
                                <p className="text-[8px] font-bold text-gray-300 uppercase">Points</p>
                              </div>
                          </div>
                        ))}
                      </div>
                    </div>
                 ))}
               </div>
             )}
          </div>
        )}
      </div>
    </div>
  );
};

// --- Main App Logic ---

export default function App() {
  const [view, setView] = useState('login');
  const [user, setUser] = useState({ empId: '', firstName: '', lastName: '', position: '', region: '', zone: '' });
  const [course, setCourse] = useState(null);
  const [scenario, setScenario] = useState(null);
  const [currentObjection, setCurrentObjection] = useState("");
  const [showAdminLogin, setShowAdminLogin] = useState(false);
  const [showAdminDashboard, setShowAdminDashboard] = useState(false);
  const [result, setResult] = useState(null);
  const [recordingState, setRecordingState] = useState('idle');
  const [masterPrompt, setMasterPrompt] = useState("Default System Prompt");

  // Auth Init
  useEffect(() => {
    const initAuth = async () => {
       await signInAnonymously(auth);
    };
    initAuth();
  }, []);

  // Select random scenario
  const handleSelectCourse = (c) => {
    const pool = allScenarios[c];
    const picked = pool[Math.floor(Math.random() * pool.length)];
    setCourse(c);
    setScenario(picked);
    setView('scenario');
  };

  const startAnalysis = async () => {
    setView('processing');
    const simulatedScore = Math.floor(Math.random() * (98 - 75 + 1)) + 75;
    
    setTimeout(async () => {
      const resultData = {
        total: simulatedScore,
        score: simulatedScore,
        isPassed: simulatedScore >= 70,
        breakdown: [
          { score: Math.floor(simulatedScore * 0.22), max: 20, label: "Voice & Tone" },
          { score: Math.floor(simulatedScore * 0.20), max: 20, label: "Structure" },
          { score: Math.floor(simulatedScore * 0.23), max: 20, label: "Product Info" },
          { score: Math.floor(simulatedScore * 0.17), max: 20, label: "Persuasion" },
          { score: Math.floor(simulatedScore * 0.18), max: 20, label: "Objection Handling" }
        ],
        aiAdvise: "คุณทำได้ดีมากในการสร้างความสัมพันธ์และเปิดใจลูกค้า น้ำเสียงมีความมั่นใจและเป็นมืออาชีพ...",
        user: user,
        course: course,
        dateStr: new Date().toISOString().split('T')[0],
        timestamp: serverTimestamp()
      };

      setResult(resultData);

      try {
        await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'leaderboard'), resultData);
      } catch (e) {
        console.error("Error saving score:", e);
      }

      setView('result');
    }, 3000);
  };

  return (
    <div className="max-w-md mx-auto bg-gray-50 min-h-screen flex flex-col shadow-2xl relative font-sans text-gray-900 overflow-hidden">
      
      {/* 1. Login View */}
      {view === 'login' && (
        <div className="p-8 flex-1 flex flex-col justify-center animate-in fade-in bg-white">
          <div className="text-center mb-10">
            <div className="flex justify-center mb-6">
               <MamaLogo className="w-24 h-24 shadow-2xl rounded-2xl" />
            </div>
            <h1 className="text-4xl font-black text-blue-900 leading-tight tracking-tight mb-2">MAMA</h1>
            <p className="text-xs font-bold text-gray-400 uppercase tracking-[0.2em]">Roleplay Evaluation Assistant</p>
          </div>
          <div className="space-y-4">
            <div className="space-y-1">
              <input value={user.empId} onChange={e=>setUser({...user, empId:e.target.value})} className="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl focus:ring-2 ring-blue-500 outline-none text-sm font-semibold placeholder:text-gray-300" placeholder="รหัสพนักงาน" />
            </div>
            <div className="grid grid-cols-2 gap-3">
              <input value={user.firstName} onChange={e=>setUser({...user, firstName:e.target.value})} className="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl focus:ring-2 ring-blue-500 outline-none text-sm font-semibold placeholder:text-gray-300" placeholder="ชื่อ" />
              <input value={user.lastName} onChange={e=>setUser({...user, lastName:e.target.value})} className="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl focus:ring-2 ring-blue-500 outline-none text-sm font-semibold placeholder:text-gray-300" placeholder="นามสกุล" />
            </div>
            <select value={user.position} onChange={e=>setUser({...user, position:e.target.value})} className="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl appearance-none outline-none text-sm font-semibold text-gray-600">
              <option value="">เลือกตำแหน่ง</option>
              {positionOptions.map(p=><option key={p} value={p}>{p}</option>)}
            </select>
            <div className="grid grid-cols-2 gap-3">
              <select value={user.region} onChange={e=>setUser({...user, region:e.target.value})} className="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl outline-none text-sm font-semibold text-gray-600">
                <option value="">RH</option>
                {Object.keys(regionData).map(rh=><option key={rh} value={rh}>{rh}</option>)}
              </select>
              <select value={user.zone} onChange={e=>setUser({...user, zone:e.target.value})} className="w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl outline-none text-sm font-semibold text-gray-600" disabled={!user.region}>
                <option value="">Zone</option>
                {user.region && regionData[user.region].map(z=><option key={z} value={z}>{z}</option>)}
              </select>
            </div>
            <button onClick={()=>setView('intro')} className="w-full bg-blue-900 hover:bg-blue-800 text-white py-4 rounded-2xl font-bold text-lg shadow-xl shadow-blue-900/20 flex items-center justify-center transition-all active:scale-95 mt-4">
              เข้าสู่ระบบ <ArrowRight className="ml-2" size={20} />
            </button>
          </div>
          <div className="mt-8 flex justify-center cursor-pointer opacity-20 hover:opacity-100 transition-opacity" onClick={()=>setShowAdminLogin(true)}>
            <Settings size={16} />
          </div>
        </div>
      )}

      {/* 2. Intro Step-by-Step */}
      {view === 'intro' && (
        <div className="flex-1 bg-white flex flex-col animate-in slide-in-from-right">
          <Header user={user} />
          <div className="p-8 flex-1 flex flex-col justify-center">
            <h2 className="text-3xl font-black text-blue-900 mb-8 tracking-tight">4 Steps to use</h2>
            <div className="space-y-4">
              {[
                { t: "1. เลือกหลักสูตร", d: "เลือกระหว่าง Basic หรือ Advanced เพื่อรับสถานการณ์จำลอง", color: "bg-blue-50 text-blue-600 border-blue-100" },
                { t: "2. ศึกษาภารกิจ", d: "ทำความเข้าใจโปรไฟล์ลูกค้าและเป้าหมายที่ต้องพิชิต", color: "bg-purple-50 text-purple-600 border-purple-100" },
                { t: "3. บันทึกเสียง", d: "อัดเสียงการนำเสนอและตอบข้อโต้แย้งภายในเวลาที่กำหนด", color: "bg-orange-50 text-orange-600 border-orange-100" },
                { t: "4. รับผลประเมิน", d: "AI วิเคราะห์จุดแข็งจุดอ่อนพร้อมให้คะแนนทันที", color: "bg-green-50 text-green-600 border-green-100" }
              ].map((s, i) => (
                <div key={i} className={`p-5 rounded-2xl border ${s.color} transition-all hover:scale-105 hover:shadow-md cursor-default`}>
                  <h3 className="font-bold text-lg mb-1">{s.t}</h3>
                  <p className="text-xs opacity-80 leading-relaxed font-medium">{s.d}</p>
                </div>
              ))}
            </div>
            <button onClick={()=>setView('menu')} className="mt-8 bg-blue-900 text-white py-4 rounded-2xl font-bold text-lg shadow-lg flex items-center justify-center active:scale-95 transition-transform">
              เริ่มใช้งาน <Play className="ml-2 fill-current" size={18} />
            </button>
          </div>
          <Footer />
        </div>
      )}

      {/* 3. Menu View */}
      {view === 'menu' && (
        <>
          <Header user={user} />
          <div className="p-6 flex-1 space-y-6 bg-gray-50">
            <h2 className="font-bold text-lg text-gray-500 px-2">เลือกหลักสูตรการเรียนรู้</h2>
            <div onClick={()=>handleSelectCourse('mama1')} className="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex items-center space-x-5 cursor-pointer hover:shadow-lg hover:border-blue-200 transition-all group">
              <div className="w-16 h-16 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center group-hover:bg-blue-600 group-hover:text-white transition-colors">
                <FileText size={28} />
              </div>
              <div className="flex-1">
                <span className="text-[10px] font-bold bg-blue-100 text-blue-700 px-2 py-0.5 rounded mb-1 inline-block">BASIC</span>
                <h3 className="text-xl font-bold text-gray-800">MAMA 1</h3>
                <p className="text-xs text-gray-400 mt-1">Strategic Conversation Starter</p>
              </div>
              <ArrowRight className="text-gray-300 group-hover:text-blue-600" />
            </div>
            <div onClick={()=>handleSelectCourse('mama2')} className="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm flex items-center space-x-5 cursor-pointer hover:shadow-lg hover:border-purple-200 transition-all group">
              <div className="w-16 h-16 bg-purple-50 text-purple-600 rounded-2xl flex items-center justify-center group-hover:bg-purple-600 group-hover:text-white transition-colors">
                <Headphones size={28} />
              </div>
              <div className="flex-1">
                <span className="text-[10px] font-bold bg-purple-100 text-purple-700 px-2 py-0.5 rounded mb-1 inline-block">ADVANCED</span>
                <h3 className="text-xl font-bold text-gray-800">MAMA 2</h3>
                <p className="text-xs text-gray-400 mt-1">Advanced Consulting Skills</p>
              </div>
              <ArrowRight className="text-gray-300 group-hover:text-purple-600" />
            </div>
          </div>
          <Footer />
        </>
      )}

      {/* 4. Scenario View */}
      {view === 'scenario' && (
        <>
          <Header title="Scenario Mission" user={user} />
          <div className="p-6 flex-1 overflow-y-auto space-y-5 pb-24 bg-gray-50">
            <div className="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm">
              <h3 className="text-blue-900 font-bold mb-3 flex items-center uppercase text-sm tracking-wide">
                <Info size={16} className="mr-2" /> สถานการณ์ (Situation)
              </h3>
              <p className="text-sm text-gray-600 leading-relaxed font-medium">
                {scenario.situation}
              </p>
            </div>
            <div className="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm">
              <h3 className="text-purple-900 font-bold mb-4 flex items-center uppercase text-sm tracking-wide">
                <User size={16} className="mr-2" /> ข้อมูลลูกค้า (Profile)
              </h3>
              <div className="space-y-3">
                <div className="flex justify-between border-b border-gray-50 pb-2">
                  <span className="text-xs text-gray-400">ชื่อ-นามสกุล</span>
                  <span className="text-sm font-bold text-gray-800">{scenario.customerProfile.name}</span>
                </div>
                <div className="flex justify-between border-b border-gray-50 pb-2">
                  <span className="text-xs text-gray-400">อายุ / อาชีพ</span>
                  <span className="text-sm font-bold text-gray-800">{scenario.customerProfile.age} / {scenario.customerProfile.occupation}</span>
                </div>
                 <div className="flex justify-between border-b border-gray-50 pb-2">
                  <span className="text-xs text-gray-400">รายได้</span>
                  <span className="text-sm font-bold text-gray-800">{scenario.customerProfile.income}</span>
                </div>
                <div className="bg-purple-50 p-3 rounded-xl mt-2">
                  <span className="text-[10px] font-bold text-purple-400 uppercase block mb-1">ข้อมูลทางการเงิน</span>
                  <p className="text-xs font-semibold text-purple-900">{scenario.customerProfile.financial}</p>
                </div>
              </div>
            </div>
            <div className="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm">
              <div className="flex justify-between items-center mb-4">
                 <h3 className="text-orange-900 font-bold flex items-center uppercase text-sm tracking-wide">
                  <Award size={16} className="mr-2" /> ภารกิจ (Objectives)
                </h3>
                <span className="text-[10px] font-bold bg-orange-100 text-orange-700 px-2 py-1 rounded-lg">
                  เวลา: {scenario.timeLimit}
                </span>
              </div>
              <ul className="space-y-3">
                {scenario.objectives.map((obj, i)=>(
                  <li key={i} className="flex items-start text-xs font-medium text-gray-600">
                    <CheckCircle size={14} className="mr-3 text-orange-500 shrink-0 mt-0.5" /> 
                    {obj}
                  </li>
                ))}
              </ul>
            </div>
            <div className="fixed bottom-0 left-0 right-0 max-w-md mx-auto p-4 bg-white/90 backdrop-blur border-t z-50">
              <button onClick={()=>{setRecordingState('idle'); setView('record_main');}} className="w-full bg-blue-900 hover:bg-blue-800 text-white py-4 rounded-2xl font-bold shadow-lg flex items-center justify-center transition-all">
                รับทราบ เริ่มบันทึกเสียง <Mic size={18} className="ml-2" />
              </button>
            </div>
          </div>
        </>
      )}

      {/* 5. Recording Main View */}
      {view === 'record_main' && (
        <div className="flex-1 flex flex-col items-center justify-center p-8 bg-gray-50">
          <Header title="Recording Phase" user={user} />
          <div className="text-center mb-10 mt-10">
            <h2 className="text-2xl font-black text-gray-800 mb-1">ช่วงการนำเสนอ</h2>
            <p className="text-xs text-gray-400 font-bold uppercase tracking-widest">Presenting Phase</p>
          </div>
          <div className="text-7xl font-mono font-light text-blue-900 mb-16 tabular-nums tracking-tighter">00:00</div>
          <div className="w-full max-w-xs flex flex-col items-center">
            {recordingState === 'idle' ? (
              <>
                 <button onClick={()=>setRecordingState('recording')} className="w-24 h-24 bg-blue-600 hover:bg-blue-500 rounded-full flex items-center justify-center shadow-xl shadow-blue-200 transition-all hover:scale-105 active:scale-95 mb-8">
                   <Mic size={36} className="text-white" />
                 </button>
                 <p className="text-xs font-bold text-gray-400 uppercase">กดเพื่อเริ่มบันทึก</p>
              </>
            ) : recordingState === 'recording' ? (
              <>
                 <button onClick={()=>setRecordingState('preview')} className="w-24 h-24 bg-white border-4 border-red-500 rounded-full flex items-center justify-center shadow-xl transition-all hover:scale-105 active:scale-95 mb-8 relative">
                   <div className="w-8 h-8 bg-red-500 rounded-md"></div>
                   <div className="absolute inset-0 rounded-full border-4 border-red-200 animate-ping opacity-50"></div>
                 </button>
                 <p className="text-xs font-bold text-red-500 uppercase animate-pulse">กำลังบันทึกเสียง...</p>
              </>
            ) : (
              <div className="flex flex-col items-center w-full space-y-6">
                <div className="flex justify-center space-x-6 w-full">
                  <button className="flex flex-col items-center justify-center w-16 h-16 bg-white rounded-2xl shadow-md border border-gray-100 hover:bg-gray-50 transition-colors">
                    <Volume2 size={20} className="text-gray-600 mb-1" />
                    <span className="text-[10px] font-bold text-gray-400">ฟังเสียง</span>
                  </button>
                  <button onClick={()=>setRecordingState('recording')} className="flex flex-col items-center justify-center w-16 h-16 bg-white rounded-2xl shadow-md border border-gray-100 hover:bg-gray-50 transition-colors">
                    <RefreshCw size={20} className="text-gray-600 mb-1" />
                    <span className="text-[10px] font-bold text-gray-400">อัดใหม่</span>
                  </button>
                </div>
                <button onClick={()=>{
                  const randomObj = scenario.objections[Math.floor(Math.random()*3)];
                  setCurrentObjection(randomObj);
                  setRecordingState('idle');
                  setView('record_objection');
                }} className="w-full bg-blue-900 text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-900/20 active:scale-95 transition-all">
                  ถัดไป: รับมือข้อโต้แย้ง
                </button>
              </div>
            )}
          </div>
          <div className="mt-auto"><Footer /></div>
        </div>
      )}

      {/* 6. Objection Recording View */}
      {view === 'record_objection' && (
        <div className="flex-1 flex flex-col p-8 bg-blue-900 text-white justify-center">
          <Header title="Objection Phase" user={user} />
          <div className="mt-10 mb-12 text-center">
            <div className="relative inline-block mb-6">
               <AlertCircle size={56} className="text-orange-400 relative z-10" />
               <div className="absolute inset-0 bg-orange-400 rounded-full blur-xl opacity-40 animate-pulse"></div>
            </div>
            <h2 className="text-lg font-bold mb-3 uppercase tracking-wider text-blue-200">ลูกค้ามีข้อสงสัย!</h2>
            <div className="bg-white/10 backdrop-blur-sm p-8 rounded-[32px] border border-white/20">
              <p className="text-2xl font-bold italic leading-relaxed">"{currentObjection}"</p>
            </div>
          </div>
          <div className="flex flex-col items-center flex-1 justify-end pb-12">
            {recordingState === 'idle' ? (
              <button onClick={()=>setRecordingState('recording')} className="bg-white text-blue-900 w-20 h-20 rounded-full flex items-center justify-center shadow-[0_0_30px_rgba(255,255,255,0.3)] hover:scale-110 transition-transform">
                <Mic size={32} />
              </button>
            ) : recordingState === 'recording' ? (
              <button onClick={()=>setRecordingState('preview')} className="bg-red-500 text-white w-20 h-20 rounded-full flex items-center justify-center animate-pulse border-4 border-white/20">
                <Square size={24} fill="currentColor" />
              </button>
            ) : (
              <div className="w-full space-y-4">
                 <div className="flex justify-center space-x-4 mb-4">
                    <button className="flex items-center px-6 py-3 bg-white/10 rounded-full text-sm font-bold hover:bg-white/20 transition-colors"><Volume2 size={16} className="mr-2"/> ฟังเสียง</button>
                    <button onClick={()=>setRecordingState('recording')} className="flex items-center px-6 py-3 bg-white/10 rounded-full text-sm font-bold hover:bg-white/20 transition-colors"><RefreshCw size={16} className="mr-2"/> อัดใหม่</button>
                 </div>
                <button onClick={startAnalysis} className="w-full bg-orange-500 hover:bg-orange-600 text-white py-5 rounded-[28px] font-bold text-xl shadow-xl transition-all active:scale-95">
                  ส่งผลประเมินให้ AI
                </button>
              </div>
            )}
            {recordingState === 'idle' && <p className="text-[10px] uppercase font-bold tracking-widest text-blue-300 mt-6 opacity-60">กดปุ่มเพื่อเริ่มอัดเสียงตอบโต้</p>}
          </div>
        </div>
      )}

      {/* 7. Processing View */}
      {view === 'processing' && (
        <div className="flex-1 flex flex-col items-center justify-center p-12 text-center bg-white">
          <div className="relative mb-8">
            <div className="w-20 h-20 border-[6px] border-gray-100 rounded-full"></div>
            <div className="w-20 h-20 border-[6px] border-blue-900 border-t-transparent rounded-full animate-spin absolute top-0"></div>
            <MamaLogo className="w-8 h-8 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 opacity-50" />
          </div>
          <h2 className="text-2xl font-black text-gray-800 mb-2">Analyzing...</h2>
          <p className="text-sm text-gray-400 font-medium leading-relaxed">AI กำลังวิเคราะห์น้ำเสียง ความแม่นยำ<br/>และเทคนิคการนำเสนอของคุณ</p>
        </div>
      )}

      {/* 8. Result Dashboard View */}
      {view === 'result' && (
        <>
          <Header title="Assessment Result" user={user} />
          <div className="flex-1 overflow-y-auto bg-gray-50 pb-24">
            <div className="bg-white m-4 p-6 rounded-[32px] shadow-sm text-center border border-gray-100">
              <div className="inline-block px-3 py-1 bg-green-100 text-green-700 text-[10px] font-black rounded-full mb-2 uppercase tracking-wide">
                PASSED
              </div>
              <div className="text-6xl font-black text-blue-900 mb-1 tracking-tighter">{result.total}</div>
              <p className="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Total Score</p>
            </div>
            <div className="px-6 mb-6">
              <h3 className="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-3 ml-2">Performance Breakdown</h3>
              <div className="grid grid-cols-5 gap-2 h-24">
                {result.breakdown.map((b, i)=>(
                  <div key={i} className="col-span-1 h-full">
                    <MiniGauge score={b.score} max={b.max} label={b.label} size="small" />
                  </div>
                ))}
              </div>
            </div>
            <div className="px-4 space-y-4">
              <div className="bg-white p-6 rounded-[28px] border border-blue-100 shadow-sm relative overflow-hidden">
                <div className="absolute top-0 left-0 w-1 h-full bg-blue-600"></div>
                <h3 className="text-blue-900 font-bold mb-3 flex items-center uppercase text-xs tracking-wider">
                  <Headphones size={16} className="mr-2" /> AI Recommendation
                </h3>
                <p className="text-sm text-gray-600 leading-relaxed font-medium">
                  {result.aiAdvise}
                </p>
              </div>
              <button onClick={()=>setView('report')} className="w-full bg-gray-900 text-white py-5 rounded-[24px] font-bold text-lg shadow-xl shadow-gray-200 active:scale-95 transition mt-4 flex items-center justify-center">
                <FileText className="mr-2" size={20} /> Report
              </button>
            </div>
            <div className="mt-8"><Footer /></div>
          </div>
        </>
      )}

      {/* 9. Report Card View */}
      {view === 'report' && (
        <div className="flex-1 bg-gray-100 flex flex-col items-center justify-center p-4">
           <div className="bg-white w-full max-w-sm rounded-[32px] overflow-hidden shadow-2xl relative">
              <div className="bg-blue-900 p-8 text-center relative overflow-hidden">
                  <div className="absolute top-0 right-0 w-32 h-32 bg-blue-800 rounded-full -mr-16 -mt-16 opacity-50"></div>
                  <div className="absolute bottom-0 left-0 w-24 h-24 bg-blue-800 rounded-full -ml-12 -mb-12 opacity-50"></div>
                  <MamaLogo className="w-16 h-16 mx-auto mb-4 bg-white rounded-2xl p-1 shadow-lg relative z-10" />
                  <h2 className="text-2xl font-black text-white tracking-tight relative z-10">Assessment Report</h2>
                  <p className="text-blue-200 text-xs font-bold uppercase tracking-widest relative z-10">MAMA Roleplay Assistant</p>
              </div>
              <div className="p-6 border-b border-gray-100">
                  <div className="grid grid-cols-2 gap-4 mb-4">
                      <div>
                          <p className="text-[10px] text-gray-400 font-bold uppercase">Name</p>
                          <p className="text-sm font-bold text-gray-800">{user.firstName} {user.lastName}</p>
                      </div>
                      <div>
                          <p className="text-[10px] text-gray-400 font-bold uppercase">Employee ID</p>
                          <p className="text-sm font-bold text-gray-800">{user.empId}</p>
                      </div>
                      <div>
                          <p className="text-[10px] text-gray-400 font-bold uppercase">Position</p>
                          <p className="text-sm font-bold text-gray-800">{user.position}</p>
                      </div>
                       <div>
                          <p className="text-[10px] text-gray-400 font-bold uppercase">Region / Zone</p>
                          <p className="text-sm font-bold text-gray-800">{user.region} / {user.zone}</p>
                      </div>
                  </div>
              </div>
              <div className="p-6 bg-gray-50 flex items-center justify-between">
                   <div>
                       <p className="text-xs text-gray-500 font-bold">Total Score</p>
                       <p className="text-5xl font-black text-blue-900">{result.total}</p>
                   </div>
                   <div className="text-right">
                       <span className="bg-green-500 text-white px-4 py-1.5 rounded-full text-xs font-black uppercase shadow-md shadow-green-200">
                           PASSED
                       </span>
                       <p className="text-[10px] text-gray-400 mt-2">{new Date().toLocaleDateString()}</p>
                   </div>
              </div>
              <div className="p-6 grid grid-cols-5 gap-1.5">
                  {result.breakdown.map((b, i)=>(
                    <div key={i} className="flex flex-col items-center">
                        <div className="h-12 w-2 bg-gray-200 rounded-full relative overflow-hidden">
                            <div className="absolute bottom-0 w-full bg-blue-600 rounded-full" style={{height: `${(b.score/b.max)*100}%`}}></div>
                        </div>
                        <span className="text-[8px] font-bold text-gray-400 mt-1">{b.score}</span>
                    </div>
                  ))}
              </div>
              <div className="bg-gray-100 p-4 text-center">
                  <p className="text-[8px] text-gray-500 font-bold uppercase tracking-wider">
                    Presented by <span className="text-blue-900">PRU Academy</span> [ttb training team]
                  </p>
              </div>
           </div>
           <button onClick={()=>setView('login')} className="mt-6 text-gray-400 text-xs font-bold flex items-center hover:text-gray-600">
               <X size={14} className="mr-1" /> Close & Return Home
           </button>
        </div>
      )}

      {/* Admin Logic Overlays */}
      {showAdminLogin && (
        <AdminLogin 
          onLogin={() => { setShowAdminLogin(false); setShowAdminDashboard(true); }}
          onCancel={() => setShowAdminLogin(false)}
        />
      )}

      {showAdminDashboard && (
        <AdminDashboard 
          onClose={() => setShowAdminDashboard(false)}
          currentPrompt={masterPrompt}
          onSavePrompt={(p) => { setMasterPrompt(p); setShowAdminDashboard(false); }}
        />
      )}
    </div>
  );
}

